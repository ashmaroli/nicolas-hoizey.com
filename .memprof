#!/usr/bin/env ruby
# frozen_string_literal: true

puts %x(free -h)
puts

require 'jekyll'
require 'memory_profiler'

Jekyll::PluginManager.require_from_bundler

puts %x(free -h)
puts

report = MemoryProfiler.report(allow_files: '_plugins') do
  Jekyll::Commands::Build.process(
    "source"      => File.expand_path(__dir__),
    "destination" => File.expand_path("_site", __dir__),
    "verbose"     => false
  )
end

puts "\nGenerating results..\n\n"

puts %x(free -h)
puts

report.pretty_print(scale_bytes: true, normalize_paths: true, color_output: false)
